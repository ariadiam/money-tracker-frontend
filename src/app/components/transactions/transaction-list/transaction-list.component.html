<div class="table-card">

  <div class="table-scroll">
    <table class="transaction-table">
      <thead>
        <tr>
          <th>Date</th>
          <th>Description</th>
          <th>Category</th>
          <th class="right">Amount</th>
          <th class="right">Actions</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let tx of pagedTransactions">
          <td>
            <ng-container *ngIf="editingTransactionId !== tx._id; else dateEdit">
              {{ tx.date | date:'mediumDate' }}
            </ng-container>
            <ng-template #dateEdit>
              <input class="inline-input" type="date" [(ngModel)]="editedTransaction.date" />
            </ng-template>
          </td>

          <td>
            <ng-container *ngIf="editingTransactionId !== tx._id; else descEdit">
              <span class="muted">{{ tx.description || '—' }}</span>
            </ng-container>
            <ng-template #descEdit>
              <input class="inline-input" type="text" [(ngModel)]="editedTransaction.description" />
            </ng-template>
          </td>

          <td>
            <ng-container *ngIf="editingTransactionId !== tx._id; else catEdit">
              <span class="badge">{{ tx.category }}</span>
            </ng-container>
            <ng-template #catEdit>
              <input class="inline-input" type="text" [(ngModel)]="editedTransaction.category" />
            </ng-template>
          </td>

          <td class="right">
            <ng-container *ngIf="editingTransactionId !== tx._id; else amountEdit">
              <span [ngClass]="['amount', tx.type]">
                {{ tx.type === 'expense' ? -tx.amount : tx.amount | currency: 'EUR' }}
              </span>
            </ng-container>
            <ng-template #amountEdit>
              <input class="inline-input right" type="number" [(ngModel)]="editedTransaction.amount" />
            </ng-template>
          </td>

          <td class="right">
            <div class="action-bar" *ngIf="editingTransactionId !== tx._id; else editBtns">
              <button class="action-btn edit" (click)="startEditing(tx)">Edit</button>
              <button class="action-btn delete" (click)="deleteTransaction(tx._id!)">Delete</button>
            </div>
            <ng-template #editBtns>
              <div class="action-bar">
                <button class="action-btn save" (click)="saveTransaction()">Save</button>
                <button class="action-btn cancel" (click)="cancelEditing()">Cancel</button>
              </div>
            </ng-template>
          </td>
        </tr>
      </tbody>
    </table>
  
    <div class="pager" *ngIf="totalPages > 1">
      <span class="muted">
        Showing {{ startItemIndex }}–{{ endItemIndex }} of {{ totalItems }}
      </span>

      <div class="pager-controls">
        <button class="pager-btn" [disabled]="currentPage === 1" (click)="goToPage(1)" aria-label="First page">«</button>
        <button class="pager-btn" [disabled]="currentPage === 1" (click)="prevPage()" aria-label="Previous page">‹</button>

        <span class="pager-page">Page {{ currentPage }} / {{ totalPages }}</span>

        <button class="pager-btn" [disabled]="currentPage === totalPages" (click)="nextPage()" aria-label="Next page">›</button>
        <button class="pager-btn" [disabled]="currentPage === totalPages" (click)="goToPage(totalPages)" aria-label="Last page">»</button>
      </div>
    </div>
  </div>

  <div class="empty" *ngIf="!transactions || transactions.length === 0">
    No transactions yet. Add your first one!
  </div>
</div>